{% schema %}
{
  "name": "Smart Offer Button",
  "target": "section",
  "stylesheet": "offer.css",
  "javascript": "offer.js",
  "settings": [
    { "type": "text", "id": "btn_text", "label": "Button Text", "default": "Make an offer" },
    { "type": "range", "id": "btn_height", "min": 30, "max": 100, "step": 1, "unit": "px", "label": "Height", "default": 44 },
    { "type": "color", "id": "btn_color", "label": "Button Color", "default": "#000000" },
    { "type": "color", "id": "btn_text_color", "label": "Text Color", "default": "#ffffff" },
    { "type": "range", "id": "btn_border_radius", "min": 0, "max": 40, "step": 1, "unit": "px", "label": "Border Radius", "default": 4 },
    { "type": "range", "id": "btn_font_size", "min": 12, "max": 24, "step": 1, "unit": "px", "label": "Text Size", "default": 16 }
  ]
}
{% endschema %}

<div class="smart-offer-container product-form__buttons">
  <button id="smart-offer-trigger" class="button button--secondary product-form__submit" style="display: none; background-color: {{ block.settings.btn_color }}; color: {{ block.settings.btn_text_color }}; border-radius: {{ block.settings.btn_border_radius }}px; font-size: {{ block.settings.btn_font_size }}px; width: 100%; min-height: {{ block.settings.btn_height }}px; cursor: pointer; align-items: center; justify-content: center;">
    {{ block.settings.btn_text }}
  </button>

  <div id="smart-offer-modal" class="smart-offer-modal" style="display: none;">
    <div class="smart-offer-chat-container">
      <div class="smart-offer-header">
        <span class="smart-offer-title">Live Negotiation</span>
        <span class="smart-offer-close">&times;</span>
      </div>
      
      <div id="smart-offer-messages" class="smart-offer-messages">
        <!-- Messages will appear here dynamically -->
      </div>

      <div class="smart-offer-input-area">
        <input type="text" id="smart-offer-input" placeholder="Your offer (e.g. I offer 45â‚¬)..." />
        <button id="smart-offer-submit">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  window.smartOfferConfig = {
    productId: "{{ product.id }}",
    variantId: "{{ product.selected_or_first_available_variant.id }}",
    shopUrl: "{{ shop.permanent_domain }}",
    productImage: "{{ product.featured_image | image_url: width: 100 }}",
    productTitle: "{{ product.title | escape }}",
    productPrice: "{{ product.price | money }}",
    collectionIds: "{{ product.collections | map: 'id' | join: ',' }}"
  };
</script>
